# name: Solar System Data Pipeline

# on:
#   schedule:
#     # Runs at 8am Central Time (13:00 UTC)
#     - cron: '0 13 * * *'
#   workflow_dispatch:  # Allows manual triggering of the workflow

# env:
#   PYTHON_VERSION: '3.9'
#   GCP_PROJECT_ID: ${{ secrets.GCP_PROJECT_ID }}

# jobs:
#   extract-and-load:
#     runs-on: ubuntu-latest
    
#     steps:
#       - name: Checkout repository
#         uses: actions/checkout@v4

#       - name: Set up Python
#         uses: actions/setup-python@v5
#         with:
#           python-version: ${{ env.PYTHON_VERSION }}

#       - name: Install dependencies
#         run: |
#           python -m pip install --upgrade pip
#           pip install requests google-cloud-bigquery

#       - name: Google Auth
#         id: auth
#         uses: google-github-actions/auth@v2
#         with:
#           credentials_json: ${{ secrets.GCP_SA_KEY }}

#       - name: Set up Google Cloud SDK
#         uses: google-github-actions/setup-gcloud@v2
#         with:
#           project_id: GCP_PROJECT_ID

#       - name: Extract data from API
#         id: extract
#         run: |
#           python fetch_data.py
#           # Verify files were created
#           if [ ! -f raw_planets.json ] || [ ! -f raw_moons.json ]; then
#             echo "Error: Data extraction failed - JSON files not created"
#             exit 1
#           fi

#       - name: Load data to BigQuery
#         id: load
#         if: steps.extract.outcome == 'success'
#         run: |
#           python load_data.py

#       - name: Handle failures
#         if: failure()
#         run: |
#           echo "Pipeline failed. Check the logs for more details."

#       - name: Clean up temporary files
#         if: always()
#         run: |
#           rm -f raw_planets.json raw_moons.json

name: Solar System Data Pipeline

on:
  workflow_dispatch:  # For testing manually

jobs:
  test-auth:
    runs-on: ubuntu-latest
    
    steps:
      - name: Checkout repository
        uses: actions/checkout@v4

      - name: Set up Google Cloud credentials
        env:
          GCP_SA_KEY: ${{ secrets.GCP_SA_KEY }}
        run: |
          echo "${GCP_SA_KEY}" > key.json
          # Let's examine the file (temporary debug step)
          echo "First few characters of key.json:"
          head -c 50 key.json
          echo "File size:"
          ls -l key.json
          
      - name: Install Google Cloud SDK
        run: |
          echo "deb [signed-by=/usr/share/keyrings/cloud.google.gpg] https://packages.cloud.google.com/apt cloud-sdk main" | sudo tee -a /etc/apt/sources.list.d/google-cloud-sdk.list
          curl https://packages.cloud.google.com/apt/doc/apt-key.gpg | sudo apt-key --keyring /usr/share/keyrings/cloud.google.gpg add -
          sudo apt-get update && sudo apt-get install google-cloud-sdk
          
      - name: Authenticate with Google Cloud
        run: |
          gcloud auth activate-service-account --key-file=key.json
          
      - name: Test Authentication
        run: |
          gcloud projects list

      - name: Cleanup
        if: always()
        run: rm -f key.json
